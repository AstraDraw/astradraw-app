// ThreadMarker styles
// Pin shape with avatar for comment thread markers

@use "../../../styles/mixins" as *;
@use "../../../styles/variables" as *;

// Pin dimensions
$pin-size: 32px;
$avatar-size: 24px;

.marker {
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: auto; // Enable clicks on markers
  cursor: pointer;
  z-index: 3;
  transition: z-index 0s;
  touch-action: none; // Prevent touch scrolling during drag

  // Offset so pin point is at the exact coordinate
  margin-left: -#{$pin-size * 0.5};
  margin-top: -#{$pin-size};

  &.hovered,
  &.selected {
    z-index: 20;
  }

  &.dragging {
    z-index: 100;
    cursor: grabbing;

    .pin {
      transform: rotate(-45deg) scale(1.1);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25), 0 4px 8px rgba(0, 0, 0, 0.15);
    }
  }
}

.pin {
  width: $pin-size;
  height: $pin-size;
  background: var(--color-surface-low, #f5f5f5);
  border-radius: 66px 67px 67px 0; // Asymmetric pin shape
  transform: rotate(-45deg);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
  transition: transform $transition-fast, box-shadow $transition-fast;

  .marker.hovered &,
  .marker.selected & {
    transform: rotate(-45deg) scale(1.03);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .marker.selected & {
    background: var(--color-primary, #6965db);
  }
}

.avatar,
.avatarFallback {
  width: $avatar-size;
  height: $avatar-size;
  border-radius: 50%;
  transform: rotate(45deg); // Counter-rotate to keep avatar upright
  border: 2px solid var(--color-surface-lowest, #fff);
}

.avatar {
  object-fit: cover;
}

.avatarFallback {
  background: var(--color-primary-light, #e8e7f8);
  color: var(--color-primary, #6965db);
  font-size: 12px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: $ui-font;

  .marker.selected & {
    background: var(--color-surface-lowest, #fff);
    color: var(--color-primary, #6965db);
  }
}

// Fade out animation for resolved markers
.fadeOut {
  animation: markerFadeOut 0.3s ease-out forwards;
  pointer-events: none;
}

@keyframes markerFadeOut {
  from {
    opacity: 1;
    transform: translate(var(--x), var(--y)) scale(1);
  }
  to {
    opacity: 0;
    transform: translate(var(--x), var(--y)) scale(0.8);
  }
}

// Dark mode
@include dark-mode {
  .pin {
    background: var(--color-surface-high, #3d3d42);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);

    .marker.hovered &,
    .marker.selected & {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .marker.selected & {
      background: var(--color-primary, #6965db);
    }
  }

  .avatar,
  .avatarFallback {
    border-color: var(--color-surface-lowest, #232329);
  }

  .avatarFallback {
    background: var(--color-primary-darker, #4a47a3);
    color: var(--color-primary-light, #e8e7f8);

    .marker.selected & {
      background: var(--color-surface-lowest, #232329);
      color: var(--color-primary-light, #e8e7f8);
    }
  }
}
